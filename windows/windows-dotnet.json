{
  "builders": [
    {
      "type": "googlecompute",
      "account_file": "account.json",
      "project_id": "language-team",
      "source_image_family": "windows-1803-core",
      "image_name": "windows-dotnet",
      "disk_size": "60",
      "disk_type": "pd-ssd",
      "machine_type": "n1-standard-8",
      "communicator": "winrm",
      "winrm_username": "cicd",
      "winrm_insecure": true,
      "winrm_use_ssl": true,
      "metadata": {
        "windows-startup-script-cmd": "winrm quickconfig -quiet & net user /add cicd & net localgroup administrators cicd /add & winrm set winrm/config/service/auth @{Basic=\"true\"}"
      },
      "zone": "europe-west1-b",
      "state_timeout": "20m",
      "tags": ["packer"]
    }
  ],
  "provisioners": [
    {
      "type": "powershell",
      "scripts": [
        "{{template_dir}}/scripts/Initialize-VM.ps1"
      ]
    },
    {
      "type": "windows-restart",
      "restart_timeout": "10m"
    },
    {
      "type": "powershell",
      "scripts": [
        "{{template_dir}}/scripts/Install-DotNetSdk.ps1"
      ]
    },
    {
      "type": "windows-restart",
      "restart_timeout": "10m"
    },
    {
      "type": "powershell",
      "inline": [
        "choco install git --version 2.19.1 --package-parameters \"/GitAndUnixToolsOnPath /NoShellIntegration\"",
        "choco install nuget.commandline --version 4.8.1",
        "choco install sonarscanner-msbuild-net46 --version 4.5.0.1761",
        "choco install nodejs --version 10.13.0",
        "choco install openjdk --version 12.0.2",
        "choco install python --version 3.7.2"
      ]
    },
    {
      "type": "powershell",
      "scripts": [
        "{{template_dir}}/scripts/Install-VS2017.ps1",
        "{{template_dir}}/scripts/install_sonar_scanner.ps1"
      ]
    },
    {
      "type": "windows-restart",
      "restart_timeout": "10m"
    },
    {
      "type": "powershell",
      "scripts": [
        "{{template_dir}}/scripts/Finalize-VM.ps1"
      ]
    }
  ]
}
